#!/usr/bin/env bash

usage() {
        echo "Usage:"
        echo -e "       \e[36m./install \e[39m[ \e[32moptions \e[39m]"
        echo -e "\e[39mOptions:"
        echo -e "       \e[39m[ \e[36mhelp \e[39m]  - \e[32mdisplay options"
        echo -e "       \e[39m[ \e[36mvim \e[39m]   - \e[32msymlink vim config files only"
        echo -e "       \e[39m[ \e[36mzsh \e[39m]   - \e[32msymlink zsh config files only"
        echo -e "       \e[39m[ \e[36mall \e[39m]   - \e[32msymlink all config files"
        echo -e "       \e[39m[ \e[36mclean \e[39m] - \e[32mremove all created symlinks"
}

setup-zsh-submodule() {
# Setup Command-T
if [[ ! -f $HOME/.vim/pack/bundle/opt/command-t/ruby/command-t/ext/command-t/ext.so ]]; then
        cd $HOME/.vim/pack/bundle/opt/command-t/ruby/command-t/ext/command-t/
        ruby extconf.rb
        make
fi

        # Setup skim
        if [[ ! -f $HOME/.zsh/vendor/skim/bin/sk ]]; then
                cd $HOME/.zsh/vendor/skim
                ./install
        fi
}

setup-zsh() {
        ln -sf $PWD/.z* $HOME
        setup-zsh-submodule
}

setup-vim() {
        if [[ ! -d $HOME/.config/nvim ]]; then
                ln -sf $PWD/.vim $HOME/.config/nvim
        else
                rm -r $HOME/.config/nvim
                ln -sf $PWD/.vim $HOME/.config/nvim
        fi

        if [[ ! -d $HOME/.vim ]]; then
                ln -sf $PWD/.vim $HOME
        else
                rm -r $HOME/.vim
                ln -sf $PWD/.vim $HOME
        fi
}

setup-misc() {
        # create ~/.config if doesn't exist
        if [[ ! -d $HOME/.config ]]; then
                mkdir $HOME/.config
        fi

        ln -sf $PWD/.config/* $HOME/.config/
        ln -sf $PWD/.asoundrc  $HOME
        ln -sf $PWD/.fonts     $HOME
        ln -sf $PWD/.gitconfig $HOME
        ln -sf $PWD/.inputrc   $HOME
        ln -sf $PWD/.lynxrc    $HOME
        ln -sf $PWD/.mpd       $HOME
        ln -sf $PWD/.ncmpcpp   $HOME
        ln -sf $PWD/.tmux.conf $HOME
        ln -sf $PWD/.xinitrc   $HOME
}


setup-all() {
        setup-zsh
        setup-vim
        setup-misc
}

clean-symlink() {
        local homeDirFile=(asoundrc fonts gitconfig inputrc lynxrc mpd ncmpcpp tmux.conf xinitrc)

        local configDirFile=(compton nvim fontconfig ranger)

        for h in ${homeDirFile[@]}; do
                if [[ -L $HOME/.$h ]]; then
                        rm -f $HOME/.$h
                fi
        done

        for c in ${configDirFile[@]}; do
                if [[ -L $HOME/.config/$c ]]; then
                        rm -f $HOME/.config/$c
                fi
        done
}

case "$1" in
zsh)
        setup-zsh
        ;;
vim)
        setup-vim
        ;;
all)
        setup-all
        ;;
help)
        usage
        ;;
clean)
        clean-symlink
        ;;
*)
        usage
        ;;
esac

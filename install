#!/usr/bin/env bash

homeDirFile=(asoundrc fonts gitconfig lynxrc mpd ncmpcpp tmux.conf xinitrc zlogin zsh zshenv zshrc)
configDirFile=(compton fontconfig ranger)
dotfilePath=$PWD
usage()
{
        echo "Usage:"
        echo -e "       \e[36m./install \e[39m[ \e[32moptions \e[39m]"
        echo -e "\e[39mOptions:"
        echo -e "       \e[39m[  \e[36mhelp \e[39m] - \e[32mdisplay options"
        echo -e "       \e[39m[  \e[36mvim  \e[39m] - \e[32msymlink vim config files only"
        echo -e "       \e[39m[  \e[36mzsh  \e[39m] - \e[32msymlink zsh config files only"
        echo -e "       \e[39m[  \e[36mall  \e[39m] - \e[32msymlink all config files"
        echo -e "       \e[39m[ \e[36mclean \e[39m] - \e[32mremove all created symlinks"
}

setup-zsh()
{
        ln -sf $PWD/.z* $HOME

        if [[ ! -f $HOME/.zsh/vendor/skim/bin/sk ]]; then
               cd $HOME/.zsh/vendor/skim
               ./install
               cd $dotfilePath
        fi
}

setup-vim()
{
        if [[ ! -d $HOME/.config/nvim ]]; then
                ln -sf $PWD/.vim $HOME/.config/nvim
        else
                rm -r $HOME/.config/nvim
                ln -sf $PWD/.vim $HOME/.config/nvim
        fi

        if [[ ! -d $HOME/.vim ]]; then
                ln -sf $PWD/.vim $HOME
        else
                rm -r $HOME/.vim
                ln -sf $PWD/.vim $HOME
        fi

        if [[ ! -f $HOME/.vim/pack/bundle/opt/command-t/ruby/command-t/ext/command-t/ext.so ]]; then
               cd "$HOME/.vim/pack/bundle/opt/command-t/ruby/command-t/ext/command-t"
               ruby extconf.rb
               make
               cd $dotfilePath
        fi
}

setup-misc()
{
        # create ~/.config if doesn't exist
        if [[ ! -d $HOME/.config ]]; then
                mkdir $HOME/.config
        fi

        for h in ${homeDirFile[@]}; do
                if [[ ! -f $HOME/.$h ]]; then
                        ln -sf $PWD/.$h $HOME
                fi
        done

        for c in ${configDirFile[@]}; do
                if [[ ! -f $HOME/.config/$c ]]; then
                        ln -sf $PWD/.config/$c $HOME/.config
                fi
        done
}


setup-all()
{
        setup-zsh
        setup-vim
        setup-misc
}

clean-symlink()
{
        for h in ${homeDirFile[@]}; do
                if [[ -L $HOME/.$h ]]; then
                        rm -f $HOME/.$h
                fi
        done

        for c in ${configDirFile[@]}; do
                if [[ -L $HOME/.config/$c ]]; then
                        rm -f $HOME/.config/$c
                fi
        done

        if [[ -d $HOME/.config/nvim ]]; then
                rm -r $HOME/.config/nvim
        fi
}

case "$1" in
zsh)
        setup-zsh
        ;;
vim)
        setup-vim
        ;;
all)
        setup-all
        ;;
help)
        usage
        ;;
clean)
        clean-symlink
        ;;
*)
        usage
        ;;
esac

#!/usr/bin/env bash

zshFile=(zlogin zsh zshenv zshrc)
homeDirFile=(asoundrc fonts gitconfig lynxrc mpd ncmpcpp tmux.conf xinitrc)
configDirFile=(compton fontconfig ranger)
REPOPATH=$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)

usage() {
        echo "Usage:"
        echo -e "       \e[36minstall \e[39m[ \e[32moptions \e[39m]"
        echo -e "\e[39mOptions:"
        echo -e "       \e[39m[  \e[36mzsh  \e[39m] - \e[32minstall zsh config files only"
        echo -e "       \e[39m[  \e[36mvim  \e[39m] - \e[32minstall vim config files only"
        echo -e "       \e[39m[  \e[36mall  \e[39m] - \e[32minstall all config files"
        echo -e "       \e[39m[ \e[36mfonts \e[39m] - \e[32minstall font files only"
        echo -e "       \e[39m[ \e[36mclean \e[39m] - \e[32mremove all created symlinks"
}

setup-fonts() {
        ln -sf $REPOPATH/.fonts $HOME
}

setup-zsh() {
        for z in ${zshFile[@]}; do
                if [[ ! -f $HOME/.$z ]]; then
                        ln -sf $REPOPATH/.$z $HOME
                fi
        done

        if [[ -d $HOME/.zsh/vendor/skim/ ]]; then
                cd $HOME/.zsh/vendor/skim
                ./install
                cd $REPOPATH
        fi
}

setup-vim() {
        if [[ ! -d $HOME/.config/nvim ]]; then
                ln -sf $REPOPATH/.vim $HOME/.config/nvim
        fi

        if [[ ! -d $HOME/.vim ]]; then
                ln -sf $REPOPATH/.vim $HOME
        fi

        if [[ -d $HOME/.vim/pack/bundle/opt/command-t/ruby/command-t/ext/command-t/ ]]; then
               cd "$HOME/.vim/pack/bundle/opt/command-t/ruby/command-t/ext/command-t"
               ruby extconf.rb
               make
               cd $REPOPATH
        fi

        if [[ -d $HOME/.vim/pack/bundle/opt/LanguageClient-neovim ]]; then
               cd "$HOME/.vim/pack/bundle/opt/LanguageClient-neovim"
               bash install.sh
               cd $REPOPATH
        fi
}

setup-misc() {
        for h in ${homeDirFile[@]}; do
                if [[ ! -f $HOME/.$h ]]; then
                        ln -sf $REPOPATH/.$h $HOME
                fi
        done

        for c in ${configDirFile[@]}; do
                if [[ ! -f $HOME/.config/$c ]]; then
                        ln -sf $REPOPATH/.config/$c $HOME/.config
                fi
        done
}


setup-all() {
        setup-zsh
        setup-vim
        setup-misc
}

clean-symlink() {
        for h in ${homeDirFile[@]}; do
                if [[ -L $HOME/.$h ]]; then
                        rm -f $HOME/.$h
                fi
        done

        for c in ${configDirFile[@]}; do
                if [[ -L $HOME/.config/$c ]]; then
                        rm -f $HOME/.config/$c
                fi
        done

        if [[ -L $HOME/.vim ]]; then
                rm $HOME/.vim
        fi

        if [[ -L $HOME/.config/nvim ]]; then
                rm $HOME/.config/nvim
        fi

        for z in ${zshFile[@]}; do
                if [[ -L $HOME/.$z ]]; then
                        rm -f $HOME/.$z
                fi
        done

        rm -f $HOME/.*.zwc*
}

if [[ ! -d $HOME/.config ]]; then
        mkdir $HOME/.config
fi

case "$1" in
zsh)
        setup-zsh
        ;;
vim)
        setup-vim
        ;;
all)
        setup-all
        ;;
fonts)
        setup-fonts
        ;;
clean)
        clean-symlink
        ;;
"")
        usage
        ;;
*)
        usage
        echo -e "\e[31merror: unrecognized options: $1"
        ;;
esac
